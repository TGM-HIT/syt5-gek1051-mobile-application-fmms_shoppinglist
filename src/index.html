<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>Shopping List</title>

  <!-- mobile styling -->
  <meta name="theme-color" content="#448AFF">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="#448AFF">
  <meta name="apple-mobile-web-app-title" content="Shopping List">

  <!-- Vuetify -->
  <link href="https://cdn.jsdelivr.net/npm/vuetify@2.6.12/dist/vuetify.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuetify@2.6.12/dist/vuetify.js"></script>
  
  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json">
</head>
<body>
  <div id="app">
    <v-app>
      <v-app-bar app color="primary" dark>
        <v-btn icon v-if="mode != 'showlist'" @click="onBack">
          <v-icon>mdi-arrow-left</v-icon>
        </v-btn>
        <v-toolbar-title>{{ pagetitle }}</v-toolbar-title>
        <v-spacer></v-spacer>
        <v-btn icon v-if="mode == 'showlist'" @click="onClickSettings">
          <v-icon>mdi-cog</v-icon>
        </v-btn>
        <v-btn icon v-if="mode == 'showlist'" @click="onClickAbout">
          <v-icon>mdi-information-outline</v-icon>
        </v-btn>
      </v-app-bar>
      
      <v-main>
        <v-container>
          <!-- Add Shopping List -->
          <v-card v-if="mode == 'addlist'">
            <v-card-title>Add Shopping List</v-card-title>
            <v-card-text>
              <v-text-field label="List name" v-model="singleList.title"></v-text-field>
              <v-text-field label="Place name" v-model="singleList.place.title"></v-text-field>
              <v-btn :disabled="!singleList.place.title" @click="onClickLookup">Lookup</v-btn>
              <v-select v-if="places.length > 1" label="Choose address" :items="places" item-text="display_name" item-value="place_id" v-model="selectedPlace" @change="onChangePlace"></v-select>
            </v-card-text>
            <v-card-actions>
              <v-btn color="primary" @click="onClickSaveShoppingList" :disabled="!singleList.title">Save</v-btn>
            </v-card-actions>
          </v-card>
          
          <!-- Shopping List Items -->
          <v-list v-if="mode == 'itemedit'">
            <v-list-item>
              <v-text-field label="New item" v-model="newItemTitle" @keyup.enter.native="onAddListItem"></v-text-field>
              <v-btn icon @click="onAddListItem" :disabled="!newItemTitle">
                <v-icon>mdi-cart-plus</v-icon>
              </v-btn>
            </v-list-item>
            <v-divider></v-divider>
            <v-list-item v-for="item in sortedShoppingListItems" :key="item._id">
              <v-checkbox v-model="item.checked" @change="onCheckListItem(item._id)"></v-checkbox>
              <v-list-item-content>
                <v-list-item-title :class="{ cardchecked: item.checked }">{{ item.title }}</v-list-item-title>
              </v-list-item-content>
              <v-btn icon @click="onShowItemDetail(item)"><v-icon>mdi-information</v-icon></v-btn>
              <v-btn icon @click="onDeleteItem(item._id)"><v-icon>mdi-delete</v-icon></v-btn>
            </v-list-item>
          </v-list>
          
          <!-- Shopping Lists -->
          <v-list v-if="mode == 'showlist'">
            <v-card v-for="list in sortedShoppingLists" :key="list._id">
              <v-card-title>{{ list.title }}</v-card-title>
              <v-card-subtitle>{{ list.place.title }}</v-card-subtitle>
              <v-card-text>{{ counts[list._id].checked }} / {{ counts[list._id].total }}</v-card-text>
              <v-card-actions>
                <v-btn @click="onClickList(list._id, list.title)">View</v-btn>
              </v-card-actions>
            </v-card>
          </v-list>
        </v-container>
      </v-main>
      
      <v-btn v-if="mode == 'showlist'" fab bottom right color="primary" @click="onClickAddShoppingList">
        <v-icon>mdi-plus</v-icon>
      </v-btn>
    </v-app>
  </div>
  
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('worker.js').then(
          function(registration) {
            console.log('ServiceWorker registered: ', registration.scope);
          },
          function(err) {
            console.log('ServiceWorker registration failed: ', err);
          }
        );
      });
    }
  </script>
  
  <!-- JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cuid/1.3.8/browser-cuid.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/pouchdb/pouchdb@6.3.4/dist/pouchdb.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/pouchdb/pouchdb@6.3.4/dist/pouchdb.find.min.js"></script>

  <script type="module" src="shoppinglist.js"></script>
  
</body>
</html>
